<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Full-stack Development â€“ Laravel course materials</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css" id="theme ">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
    <link rel="stylesheet" href="main.css">
</head>

<body>

<div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section data-background="#b5533c">
            <h3>Full-stack Development  [OGI03<span style="text-transform: none">r</span>]</h3>
            <h1>10. Document,<br> Test &amp; Deploy</h1>
        </section>

        <!-- Digging deeper -->
        <section>
            <section>
                <h2>10.1<br>Digging deeper</h2>
            </section>

            <section>
                <h2>Laravel Subjects we didn't talk about</h2>
                <ul style="font-size: 85%;">
                    <li>
                        Let's have a tiny introduction to &hellip;
                        <ul>
                            <li>
                                <a href="https://laravel.com/docs/10.x/logging">Logging</a>
                                <br>
                                Hint: check 1 of the Laravel log readers, or try <a href="https://laravel.com/docs/10.x/telescope">Laravel Telescope</a>
                            </li>
                            <li>
                                <a href="https://laravel.com/docs/10.x/artisan#writing-commands">Writing commands</a> for Artisan Console
                            </li>
                            <li>
                                <a href="https://laravel.com/docs/10.x/mail">Mail</a> and Mailables
                            </li>
                            <li>
                                <a href="https://laravel.com/docs/10.x/scheduling">Task Scheduling</a> (<a href="https://laravel.com/docs/10.x/scheduling#running-the-scheduler">how to run the scheduler</a>)
                            </li>
                            <li>
                                <a href="https://laravel.com/docs/10.x/localization">Localization</a> and <a
                                href="https://laravel-lang.com/">Laravel Lang</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        And there's much more:
                        <a href="https://laravel.com/docs/10.x/cache">Cache</a>
                        <a href="https://laravel.com/docs/10.x/events">Events</a>
                        <a href="https://laravel.com/docs/10.x/socialite">Socialite</a>
                        &hellip;
                    </li>
                </ul>
            </section>
        </section>


        <!-- Web API Documentation -->
        <section>
            <section>
                <h2>10.2<br>Web API Documentation</h2>
            </section>

            <section>
                <h2>Web API Documentation</h2>

                <ul style="font-size: 90%;">
                    <li>
                        Technical document containing instructions how to effectively use a Web API
                    </li>
                    <li style="margin-top: 1.5em;">
                        Concise but containing all information required to work with the Web API
                    </li>
                    <li style="margin-top: 1.5em;">
                        Typically: web doc automatically generated from code (annotations)
                    </li>
                    <li style="margin-top: 1.5em;">
                        <strong>Why is it important? </strong> Better dev experience, so better adoption of your Web API, save support
                        time, &hellip;
                    </li>

                </ul>
                <p  style="font-size: 90%;">&longrightarrow; let's have a look at <a href="https://swagger.io/tools/swagger-ui/">Swagger UI</a>, generating documentation from <em>OpenAPI specs</em>
                </p>

            </section>
            <section>
                <h2>Documenting your Laravel REST API</h2>

                <ul style="font-size: 90%;">
                    <li>OpenAPI / Swagger (<a href="https://gdebrauwer.dev/blog/documenting-your-laravel-rest-api/">article</a>)
                        <ul>
                            <li>
                                generate from docblocks in your code with packages like <a href="https://github.com/DarkaOnLine/L5-Swagger">L5-swagger</a> (<a
                                href="https://blog.quickadminpanel.com/laravel-api-documentation-with-openapiswagger/">tutorial</a>)
                            </li>
                            <li>
                                DIY with a tool like <a href="https://stoplight.io/studio">Stoplight Studio</a>
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1.5em;">Other projects rely on a <em>JavaDoc-like</em> docblocks
                        <ul>
                            <li><a href="https://scribe.knuckles.wtf/">Scribe</a></li>
                            <li><a href="https://github.com/ovac/idoc">ovac/idoc</a></li>
                            <li>not supported any more: <a href="https://github.com/mpociot/laravel-apidoc-generator">mpociot/laravel-apidoc-generator</a></li>
                        </ul>
                    </li>

                </ul>

            </section>

        </section>

        <!-- Testing -->
        <section>
            <section>
                <h2>10.3<br>Testing</h2>
            </section>

            <section>
                <h2>Testing overview</h2>

                <ul>
                    <li>Check the <a href="07.testing.html">slides on Testing</a>

                        <ul style="font-size: 90%;">
                            <li>Unit tests</li>
                            <li><a href="https://laravel.com/docs/10.x/http-tests">HTTP tests</a> (= <em>scenario</em> or <em>feature</em> tests)</li>
                            <li><a href="https://laravel.com/docs/10.x/console-tests">Console Tests</a>
                            </li>
                            <li>Browser Tests with <a href="https://laravel.com/docs/10.x/dusk">Laravel Dusk</a></li>
                            <li>Creating <a href="https://laravel.com/docs/10.x/database-testing">test database</a> records with model factories and seeders</li>
                        </ul>
                    </li>
                </ul>

            </section>

            <section>
                <h2>What to test?</h2>

                <ul>
                    <li>
                        What to test in a Web API or Web application?
                        <ul style="font-size: 90%;">
                            <li>This is <em>opinionated</em></li>
                            <li>
                                At least
                                <ul>
                                    <li>Unit test your <em>own</em> classes (e.g. <code>ShoppingCart</code>, <code>Address</code>); testing Eloquent models is unnecessary</li>
                                    <li>HTTP test the <em>expected</em> (e.g. can a user register for this website?)</li>
                                    <li>HTTP test the <em>unexpected</em> (e.g. what happens if a user registers with wrong input?)</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>

        </section>


        <!-- Testing -->
        <section>
            <section>
                <h2>10.4<br>Linting &amp; Code Analysis</h2>
            </section>

            <section>
                <h2>Overview</h2>

                <ul>
                    <li>
                        Goals
                        <ul style="font-size: 90%;">
                            <li>improve code quality</li>
                            <li>catch potential bugs</li>
                            <li>improve performance</li>
                            <li>improve security</li>
                        </ul>

                    <li style="margin-top: 0.5em;">Tools

                        <ul style="font-size: 90%;">
                            <li><a href="https://laravel.com/docs/10.x/pint">Laravel Pint</a> (style)</li>
                            <li><a href="https://github.com/larastan/larastan">Larastan</a> (code analysis)</li>
                            <li><a href="https://www.laravel-enlightn.com/">Enlightn</a> (performance &amp; security)</li>
                        </ul>
                    </li>

                    <li style="margin-top: 0.5em;">Integrate them as Git hooks

                        <ul style="font-size: 90%;">
                            <li>
                                Manual example:
                                <a href="https://laraveldaily.com/post/laravel-pint-pre-commit-hooks-github-actions">Pint pre-commit hook</a>
                            </li>
                            <li>
                                Auto-install by <a href="https://github.com/igorsgm/laravel-git-hooks">igorsgm/laravel-git-hooks</a>

                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 0.5em;">
                        Integrate them in your CI/CD pipeline
                    </li>
                </ul>

            </section>

        </section>

        <!-- (Manual) Deployment -->
        <section>
            <section>
                <h2>10.5<br>(Manual) Deployment</h2>
            </section>

            <section>
                <h2>Demo: deployment on Plesk (1)</h2>
                <ul style="font-size: 90%">
                    <li>Some technical details on ikdoeict-plesk
                    <ul>
                        <li>
                            You login to Plesk on <code>https://firstnamelastname.ikdoeict.be:8443/</code> using your Odisee-credentials
                        </li>
                        <li style="margin-top: 0.5em;">
                            You can use the SSH Terminal (in order to run commands) from the Plesk web interface, or with an SSH client (like PuTTY)
                        </li>
                        <li style="margin-top: 0.5em;">
                            Set up for an SSH client:
                            <ol>
                                <li>Generate a key pair e.g. <code>ssh-keygen -t rsa -b 2048</code></li>
                                <li>Register the public key in Plesk (pull button &gt; SSH Keys Manager)</li>
                                <li>Find IP address and username in Plesk (tab Hosting &amp; DNS &gt; Hosting &gt; Hosting Settings)</li>
                                <li>Configure your SSH client with private key, IP address and username</li>
                            </ol>
                        </li>
                    </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Demo: deployment on Plesk (2)</h2>
                <ol style="font-size: 80%">
                    <li>Login to SSH Terminal and
                        <pre class="bigger"><code class="hljs bash">git clone https://gitlab.com/ikdoeict/joris.maervoet/laravel-tasks-api.git</code></pre>
                    </li>
                    <li>
                        In Plesk, add a subdomain <code>tasks.jorismaervoet.ikdoeict.be</code>
                        <br>
                        and point the Document Root of the subdomain to the public folder of the Laravel project:
                        <code>&lt;home&gt;/laravel-tasks-api/app/public</code>
                    </li>
                    <li style="margin-top: 0.5em;">
                        From Plesk's <strong>subdomain</strong> panel
                        <ol>
                            <li>Click on SSL/TLS certificate and add valid SSL/TLS certificate from Let's Encrypt</li>
                            <li>Click on PHP-settings and choose the most recent PHP version (display_errors should be "Off" - you're in production)</li>
                            <li>Click on Databases and create an empty database and copy db name, user name and password to notepad</li>
                            <li>Click on PHP Composer and try to install the Laravel-packages (or just run <code>composer install --no-dev</code>)
                                <ul>
                                    <li>Problems? remove <code>composer.lock</code> and <code>vendor</code> in the File Manager and retry</li>
                                </ul>
                            </li>
                        </ol>
                    </li>
                </ol>
            </section>

            <section>
                <h2>Demo: deployment on Plesk (2)</h2>
                <ol style="font-size: 80%;width:75%;" start="4">
                    <li>From SSH Terminal
                        <pre class="bigger"><code class="hljs bash">cd laravel-tasks-api/app/
cp .env.example .env
php artisan key:generate</code></pre>
                    </li>
                    <li>
                        Manually edit <code>.env</code>
                        <pre class="bigger"><code class="hljs bash">APP_DEBUG=false
APP_URL=https://tasks.jorismaervoet.ikdoeict.be
DB_HOST=localhost
DB_DATABASE=(copy from your notepad)
DB_USERNAME=(copy from your notepad)
DB_PASSWORD=(copy from your notepad)</code></pre>
                        In case it's a web API used from an SPA from other subdomain with auth:
                        <pre class="bigger"><code class="hljs bash">SANCTUM_STATEFUL_DOMAINS=ikdoeict.be,frontend.bartdelrue.ikdoeict.be
SESSION_DOMAIN=ikdoeict.be</code></pre>
                    </li>
                    <li style="margin-top: 0.5em;">Further run in SSH Terminal
                        <pre class="bigger"><code class="hljs bash">php artisan storage:link
php artisan migrate
php artisan db:seed</code></pre>

                    </li>
                </ol>
            </section>

            <section>
                <h2>Further optimization</h2>
                <ul style="font-size: 80%;width:80%;">
                    <li>Read the <a href="https://laravel.com/docs/10.x/deployment#optimization">docs on Optimization</a> carefully and further optimize production with
                        <pre class="bigger"><code class="hljs bash">composer install --optimize-autoloader --no-dev
php artisan config:cache
php artisan route:cache
php artisan view:cache</code></pre>

                    </li>
                    <li style="margin-top: 1em;">Your webapp is even faster but enabling these caches might have side-effects! Caution!</li>
                </ul>

            </section>

            <section>
                <h2>Maintenance mode</h2>
                <ul style="font-size: 80%;width:80%;">
                    <li>Did you know you can put the whole application in <a
                        href="https://laravel.com/docs/10.x/configuration#maintenance-mode">maintenance mode</a>?
                        <pre class="bigger"><code class="hljs bash">php artisan down</code></pre>

                    </li>
                    <li style="margin-top: 1em;">Guess how to disable maintenance mode ;-)</li>
                </ul>

            </section>

            <section>
                <h2>Updating</h2>
                <ul style="font-size: 80%;width:80%;">
                    <li>Boils down to running a set of commands, for example (just an example !)
                        <pre class="bigger"><code class="hljs bash">php artisan down
git pull
composer install --optimize-autoloader --no-dev
php artisan migrate
php artisan cache:clear
php artisan route:cache
php artisan view:clear
php artisan view:cache
php artisan config:cache
php artisan up</code></pre>


                    </li>
                    <li style="margin-top: 1em;"><strong>Zero downtime: </strong> actually, it's better to clone any new version into a new directory, and to switch a symlink to the new version</li>
                </ul>

            </section>



        </section>


        <section>
            <section>
                <h2>10.6<br>Laravel Envoy</h2>
            </section>

            <section>
                <h2>Laravel Envoy</h2>
                <ul>
                    <li>a tool executing commands (over SSH) on remote servers</li>
                    <li>uses the Blade syntax to define tasks for deployment</li>
                </ul>
            </section>

            <section>
                <h2>How does it work?</h2>
                <ul style="font-size: 80%;width: 80%;">
                    <li>Install Envoy into your project
                        <pre class="bigger"><code class="hljs bash">composer require laravel/envoy --dev</code></pre>
                    </li>
                    <li>Define your tasks in <code>/Envoy.blade.php</code>:
                        <pre class="bigger"><code class="hljs php">@servers(['web' =&gt; ['user@192.168.1.1'], 'workers' =&gt; ['user@192.168.1.2']])

@task('deploy', ['on' =&gt; 'web'])
    cd /home/user/example.com
    git pull origin {{ $branch }}
    php artisan migrate --force
@endtask</code></pre>
                    </li>
                    <li>
                        Run a task by
                        <pre class="bigger"><code class="hljs bash">php vendor/bin/envoy run deploy --branch=master</code></pre>
                    </li>
                    <li>Want more? <a href="https://laravel.com/docs/10.x/envoy">Envoy Docs</a> </li>
                    <li><a href="https://warrickbayman.medium.com/zero-downtime-laravel-deployments-with-envoy-version-2-227c8259e31c#1ed2">Example</a></li>
                    <li>In a CI/CD context often executed only on the production server</li>
                </ul>
            </section>

        </section>

        <section>
            <section>
                <h2>10.7<br>CI/CD: an Introduction</h2>
            </section>

            <section>
                <h2>CI/CD</h2>
                <ul>
                    <li>
                        <strong>Continuous Integration:</strong> each time you push your code changes, automated builds and tests are run
                    </li>
                    <li style="margin-top: 1em;"><strong>Continuous Delivery/Deployment:</strong> your application is also deployed continuously with/without human intervention </li>
                    <li style="margin-top: 1em;"><em>(gitlab CI/CD supports these processes &hellip;)</em> </li>
                </ul>
            </section>

            <section>
                <h2>CI/CD in gitlab</h2>
                <figure >
                    <img src="assets/06/gitlab_workflow_example_11_9.png" alt="Gitlab Workflow example" height="400">
                </figure>
            </section>

            <section>
                <h2>Let's have a look together</h2>
                <ul style="font-size: 80%;">
                    <li>
                        Loris Leiva, <a href="https://lorisleiva.com/using-gitlabs-pipeline-with-laravel">Using GitLab's pipeline with Laravel</a>

                    </li>
                    <li>(Loris Leiva, <a href="https://lorisleiva.com/laravel-deployment-using-gitlab-pipelines">Laravel deployment using GitLab's pipelines</a>)
                    </li>
                    <li>
                        GitLab Docs, <a href="https://docs.gitlab.com/ee/ci/examples/laravel_with_gitlab_and_envoy/">Test and deploy Laravel applications with GitLab CI/CD and Envoy</a>
                    </li>

                </ul>
            </section>

        </section>





        <!-- The END -->
        <section>
            <section>
                <h2>Questions?</h2>
                <footer>
                    <em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:joris.maervoet@odisee.be">joris.maervoet@odisee.be</a></em>
                </footer>
            </section>
            <section>
                <h2>Sources</h2>
            </section>
        </section>


    </div>

</div>

<script src="dist/reveal.js"></script>
<script src="plugin/zoom/zoom.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/search/search.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>

    // Also available as an ES module, see:
    // https://revealjs.com/initialization/
    Reveal.initialize({
        controls: true,
        progress: true,
        center: true,
        hash: true,
        slideNumber: true,


        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
    });


</script>
<script src="toc.js"></script>
<script src="overlay.js"></script>

</body>
</html>
